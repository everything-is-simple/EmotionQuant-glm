# EmotionQuant 系统批判报告（Claude 第一轮 — 初始系统评估）

**作者**: Claude (Anthropic claude-4.6-opus)
**生成时间**: 2026-02-07（回溯重建于 2026-02-09）
**状态**: 终稿（回溯版）
**性质**: 首次接触项目的全面初审。本报告在 R31 审查完成后回溯重建——原始 R1 审查以会话内讨论形式完成，未保存为独立文件。

---

## 0. 回溯说明

本报告基于以下证据回溯重建 R1 审查内容：

- R2 报告开篇引述的项目基线状态（138 个 .md 文件、34,541 行文档、264 行代码）
- R3 报告对 R2 结论的引用（"第二轮核心结论是 34,541 行文档 vs 264 行 stub 代码"）
- R5 追踪表中 R1-R4 的累计统计（R1-R4 合计约 46 项）
- R6 对 R1-R5 覆盖范围的概述："代码/文档比例失衡、质量扫描误报、导入路径、铁律合规、快照字段"

R1 的定位是**首次全面系统评估**，为后续 R2（对照成熟项目）和 R3（细节钻孔）奠定基线。

---

## 1. 项目首次接触基线

| 指标 | 数值 | 评估 |
|------|------|------|
| 项目启动日 | 2026-02-01 | 第 6 天 |
| Git 提交数 | ~45 | 全部为文档/治理类 |
| src/*.py 文件 | 28 | 全为占位 stub |
| src/ 总行数 | 264 | 含空行、注释、import |
| NotImplementedError | 10 | 所有业务方法 |
| tests/ | 9 个空 `__init__.py` | 零可执行测试 |
| 文档文件数 | 138 | docs/ + Governance/ + .claude/ |
| 文档总行数 | 34,541 | 约 13 万字 |
| 代码/文档比 | 1:130 | 严重倒挂 |

---

## 2. R1 发现（初始评估，共 11 项）

### P0 — 结构性问题（4 项）

#### P0-R1-01：项目无可运行代码

**现象**: 28 个 Python 源文件全部为 stub，所有业务方法实现为 `raise NotImplementedError`。无法执行任何功能。tests/ 目录下全是空 `__init__.py`，`pytest -v` 收集 0 个测试项。

**影响**: 项目第 6 天，功能代码产出为零。设计文档描述的系统完全不存在于代码中。

---

#### P0-R1-02：文档与代码严重脱节

**现象**:
- 设计文档定义了完整的四层数据架构（L1-L4）、三大核心算法（MSS/IRS/PAS）、集成框架、回测引擎、交易系统、GUI 界面、分析报告
- 代码中：无数据采集实现、无算法实现、无集成实现、无回测实现、无交易实现、无 GUI 实现、无分析实现
- `src/data/models/snapshots.py` 仅有骨架 dataclass（字段不完整），与 `data-layer-data-models.md` 的 19+ 字段定义不匹配

**影响**: 设计文档不是对现有系统的描述，而是对理想系统的构想。

---

#### P0-R1-03：依赖声明不完整

**现象**:
- 设计文档声称"DuckDB 单库优先"，`pyproject.toml` 无 `duckdb` 依赖
- 设计文档声称"主选研究平台 Qlib"，`pyproject.toml` 无 `pyqlib` 依赖
- `requirements.txt` 将 pytest/black/flake8 等开发依赖混入核心依赖

**影响**: `pip install` 后无法运行设计文档描述的任何功能。

---

#### P0-R1-04：Config.py 工程缺陷

**现象**:
- `except Exception` 吞掉所有异常（含 SyntaxError、MemoryError）
- 使用 pydantic-settings v1 废弃 API（`class Config` 内嵌类）
- .env 中定义的多个字段（STREAMLIT_PORT、BACKTEST_* 等）在 Config 类中无对应字段
- 所有路径默认值为空字符串，.env 加载失败时系统拿到空路径

**影响**: 唯一有逻辑的代码文件也存在多处工程缺陷。

---

### P1 — 设计一致性问题（4 项）

#### P1-R1-05：MSS 因子权重表加和异常

**现象**: `mss-algorithm.md` §2.1 表格中六因子权重加和为 115%（20+40+40+5+5+5），而非 100%。实际采用两层加权（base_temperature × 0.85 + 三个增强因子各 × 0.05），但表格用单层百分比展示导致误读。

**影响**: 实现者按表格直接编码会得到错误结果。

---

#### P1-R1-06：Z-Score 冷启动未定义

**现象**: MSS/IRS/PAS 算法均使用 `zscore_normalize(value, mean, std)` 进行因子归一化，但未定义：
- 历史 mean/std 参数的来源和存储格式
- 系统首次部署时的初始参数
- 参数更新策略（在线/离线/滚动窗口）

**影响**: 系统部署首日无法执行任何因子归一化。

---

#### P1-R1-07：IRS 行业估值因子聚合方式未定义

**现象**: `irs-algorithm.md` §3.4 引用 `industry_pe_ttm`，但 `data-layer-data-models.md` 仅有个股级 `pe_ttm`。从个股 PE 到行业 PE 的聚合方式（市值加权？中位数？简单平均？）未在任何文档中定义。

**影响**: PE 聚合方式直接影响估值因子语义，不同实现将产出不同结果。

---

#### P1-R1-08：.env 硬编码路径与铁律矛盾

**现象**: `.env` 中包含 G: 盘绝对路径（`DATA_PATH=G:/EmotionQuant_data` 等 5 条），绑定单台机器。同时铁律 #4 "路径硬编码绝对禁止"。`.env` 作为配置注入点可以包含路径，但 Config 类无 fallback 默认路径逻辑，.env 缺失时系统拿到空路径。

**影响**: 换机器即全崩，且无容错。

---

### P2 — 次要问题（3 项）

#### P2-R1-09：LICENSE 文件缺失

**现象**: README 声称 MIT 许可证，`pyproject.toml` 写了 `license = {text = "MIT"}`，但仓库无 LICENSE 文件。法律上等同于默认版权保留。

---

#### P2-R1-10：README "快速开始"不可执行

**现象**: README 列出 `pytest -v` 作为"基础检查"，实际收集 0 个测试项。README 描述的开发流程无法实际执行。

---

#### P2-R1-11：治理文档版本号膨胀

**现象**: 项目第 6 天，ROADMAP v6.1.0、CORE-PRINCIPLES v5.0.0、系统铁律 v5.0.0。版本号标记的是 markdown 修改次数而非可用状态变化。

---

## 3. R1 结论

### 核心判断

项目处于**纯设计阶段**，34,500+ 行设计文档对应 0 行可运行代码。设计文档本身存在权重计算错误、冷启动未定义、聚合方式未定义等具体问题，且与实际代码/依赖存在系统性脱节。

### 后续审查方向建议

1. **R2**: 对照成熟开源量化项目（Qlib/vnpy/backtrader），评估治理体系是否过度配置
2. **R3**: 逐文件细节钻孔，找出设计文档内部的 bug、矛盾和工程硬伤
3. **R4+**: 跨模块契约一致性、算法边界条件、数据模型完整性

---

## 4. 报告元信息

- 编写人：Claude (Anthropic claude-4.6-opus)
- 原始审查时间：2026-02-07
- 回溯重建时间：2026-02-09
- 回溯依据：R2-R6 报告中的交叉引用、R9 累计统计表、R31 最终统计
- 审查基线：develop 分支，项目第 6 天状态
